language: csharp
sudo: required
mono: none
dotnet: 5.0.101
branches:
  only:
    - main
services:
  #Enable docker service inside travis
  - docker

# before_install:
#     - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"

before_install:
  - wget -qO- https://toolbelt.heroku.com/install.sh | sh #installed heroku CLI
  # - docker login -u "$HEROKU_USERNAME" --password=$HEROKU_PASSWORD registry.heroku.com #logged in
  # - docker login --username=_ --password=$HEROKU_AUTH_TOKEN registry.heroku.com

# script:
#   #build the image
#   - docker build --no-cache -t 1000003/asp-net-core-app-with-docker-support .
#   #tag the build
#   - docker tag 1000003/asp-net-core-app-with-docker-support:latest 1000003/asp-net-core-app-with-docker-support:v1
#   #push the image to the repository
#   - docker push 1000003/asp-net-core-app-with-docker-support

script:
  - docker build --no-cache -t 1000003/asp-net-core-app-with-docker-support .
  # - docker tag quarkus7/which-tram registry.heroku.com/$HEROKU_APP_NAME/web
  - docker tag 1000003/asp-net-core-app-with-docker-support:latest 1000003/asp-net-core-app-with-docker-support:registry.heroku.com/dummy-asp-net-core-app-v1/web
  - docker push registry.heroku.com/dummy-asp-net-core-app-v1/web
  # - ( echo "$HEROKU_USERNAME" echo "$HEROKU_PASSWORD" ) | heroku login -i
  - heroku container:login
  - heroku container:release web --app dummy-asp-net-core-app-v1